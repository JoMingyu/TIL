# Docker와 관련된 것들
## 이 프로젝트에서 Dockerize의 역할
- ECS 배포용
- docker-compose에서 이런저런 환경변수들을 inject함으로써 로컬에서 API를 띄우기 위한 용도

## 관련 파일들
- Dockerfile
- docker-entrypoint.sh
- docker-compose.yml
- Makefile

## Dockerfile
### FROM python:3.6.8-stretch
이것처럼 `stretch`나 `jessie`가 붙은 것은 Debian 릴리즈의 코드 네임이라고 한다. 자주 볼 수 있는 `alpine`은 Alpine Linux 기반을 뜻한다.

### ENV PYTHONUNBUFFERED 1
Python에서 I/O의 buffering을 없애기 위해 `PYTHONUNBUFFERED` 환경 변수를 사용할 수 있다. 성능 측면에서는 버퍼링되지 않은 I/O를 사용하면 약간의 손실이 발생할 수 있다고 한다. 그러나 로그 메시지가 버퍼링된 상태에서 어플리케이션이 모종의 이유로 crash되게 되면 로그가 유실될테니 감수하는 듯.

### ENTRYPOINT ["/web/docker-entrypoint.sh"]
이 커맨드로 인해 제어가 `docker-entrypoint.sh`로 넘어간다.

## docker-entrypoint.sh
- `DJANGO_SETTINGS_MODULE` 환경변수로 config module 명시. Flask에서의 `FLASK_CONFIG`같은 역할인듯
- `django.core.management.execute_from_command_line`에서 `shell`이라는 커맨드가 있어서 신기했다.
- django management에 crontab 기능도 있다 ㄷㄷ `settings.py`에 있는 cronjob 정보를 가지고 설정하는듯.
- gunicorn으로 서버 시작함
- 실행 단에 할 짓이 많으면 이렇게 shell script로 분기시키는 것도 좋은 패턴인 것 같다

## docker-compose.yml
- 로컬의 환경 변수를 container로 끌고 가서 api service를 생성
- 로컬에서 API 서버를 띄워보기 위한 용도인 듯

## Makefile
- docker-compose에 있는 api service를 조금 더 쉽게 컨트롤하기 위한 매개체
- 이렇게 makefile에 로컬 서버를 띄우는 커맨드를 두는 패턴은 매우 좋은 것 같음
